<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>	
	<title>Cloudify - {{ page.title }}</title>
	<script src="//cdn.optimizely.com/js/59503762.js"></script>
	<link rel="stylesheet" href="/css/template.css" type="text/css"/>	
	<link rel="canonical" href="http://www.cloudifysource.org{{page.url}}"/>	
	<link rel="stylesheet" href="/css/jquery-ui-1.8.17.custom.css" type="text/css" media="all"/>
	<link rel="stylesheet" type="text/css" href="/scripts/prettify/prettify.css">	
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
	<script type="text/javascript" src="/scripts/jquery-1.6.4.js"></script>
	<script type="text/javascript" src="/scripts/search.js"></script>
	<script type="text/javascript" src="/scripts/jquery-ui-1.8.17.custom.min.js"></script>
	<script type="text/javascript" src="/scripts/jquery.prettyPhoto.js"></script>
	<script type="text/javascript" src="/scripts/prettify/prettify.js"></script>
	<script type="text/javascript" src="/scripts/version.data.js"></script>
	<script type="text/javascript" src="/scripts/version.js"></script>			
	<script type="text/javascript">
	window.onload = function () {
		$('body').addClass("bodyClass");	
 	}
	
	$(function(){ 
		$("a.youtube").YouTubePopup({ hideTitleBar: true });
		$("div.expand").hide();
		$("span.inlineExpandBtn").append("<span class='arrow arrowsDown'>&raquo;</span>").click(function(){
			$(this).children('span.arrow').toggleClass('arrowsDown').toggleClass('arrowsUp');
			$(this).parent().next("div.expand").slideToggle(500);
		});
		$("span.expandBtn").append("<span class='arrow arrowsDown'>&raquo;</span>").click(function(){
			var div = $(this),
				divExpand = div.children("div.expand"),
				divExpandIframe = divExpand.children("iframe");
			
			div.children('span.arrow').toggleClass('arrowsDown').toggleClass('arrowsUp');
			if (divExpand.length==0) {
				divExpand = $("<div class='expand' />").hide().appendTo(div);
				divExpand.width(700).height(480).css("border", "1px outset");
			}
			if (divExpandIframe.length==0) {
				divExpandIframe = $("<iframe />").appendTo(divExpand);
				divExpandIframe.width(700).height(480).css({"overflow":"auto", "border":"0"});
				if ($.browser.webkit) {
					divExpandIframe.contents().find("html").css("background", "none");
					divExpandIframe.contents().find("head").append('<link rel="stylesheet" href="/css/template.css" type="text/css"/>');
					divExpandIframe.contents().find("head").append('<link rel="stylesheet" href="/css/jquery-ui-1.8.17.custom.css" type="text/css" media="all"/>');
					divExpandIframe.contents().find("head").append('<link rel="stylesheet" type="text/css" href="/scripts/prettify/prettify.css">');
					divExpandIframe.contents().find("body").css("margin-left", "30px");
					//divExpandIframe.contents().find("body").load(div.attr("title") + " #pageContent");
					
					$.get(div.attr("title"), function(data) {
						data = data.split("</head>")[2];
						data = data.replace(/^[\s\S]*?(<div.*?id="pageContent".*?>[\s\S]*?<\/div>)[\s\S]*?<div class="clear">[\s\S]*?$/, "$1");
						
						var gistScripts = data.match(/<script src="https:\/\/gist.github.com\/[\d]+\.js.*?">/g);
						console.log('gistScripts.length: ' + gistScripts.length);
						if (gistScripts.length > 0) {
							var jsFile = null;
							divExpandIframe.contents().find("head").append('<link rel="stylesheet" href="https:\/\/gist.github.com/stylesheets/gist/embed.css"/>');
							for (var i=0; i < gistScripts.length; i++) {
								jsFile = gistScripts[i].replace(/<script src="(https:\/\/gist.github.com\/[\d]+\.js).*?">/, "$1");
								console.log('jsFile: ' + jsFile); 
								//$.ajax({
								//	url:jsFile,
								//	cache: true,
								//	dataType:"script"
									//processData: false,
									//xhrFields: { withCredentials: true },
									//success: function(scriptData){
									//	console.log('scriptData: ' + scriptData);
									//	var content = scriptData.match(/<div.*\\n/);
									//	console.log('content: ' + content);
									//	data = data.replace('<script src="jsFile.*?">', content);
									//}
								//}).done
								$.get(jsFile, {}, function(scriptData) {
									console.log('scriptData: ' + scriptData);
									var content = scriptData.match(/<div.*\\n/);
									console.log('content: ' + content);
									data = data.replace('<script src="jsFile.*?">', content);
								});
							}
						}
						divExpandIframe.contents().find("body").html(data);
						//divExpandIframe.contents().find("body").html(divExpandIframe.contents().find("#pageContent").html());
					});
				}
				else
					divExpandIframe.load(function(){
						divExpandIframe.contents().find("html").css("background", "none");
						divExpandIframe.contents().find("head").append('<link rel="stylesheet" href="/css/template.css" type="text/css"/>');
						divExpandIframe.contents().find("head").append('<link rel="stylesheet" href="/css/jquery-ui-1.8.17.custom.css" type="text/css" media="all"/>');
						divExpandIframe.contents().find("head").append('<link rel="stylesheet" type="text/css" href="/scripts/prettify/prettify.css">');
						divExpandIframe.contents().find("body").css("margin-left", "30px");
						//divExpandIframe.contents().find("body").load(div.attr("title") + " #pageContent");
						
						$.get(div.attr("title"), function(data) {
							//alert(data);
							divExpandIframe.contents().find("body").html($("#pageContent", data));
							//divExpandIframe.contents().find("body").html(divExpandIframe.contents().find("#pageContent").html());
						});
					});
			}
			divExpand.slideToggle(500);
		});
		$("li.expandBtn").click(function(){	
			$(this).next("div.expand").slideToggle(500);
			if($(this).html()=="More..."){
				$(this).html("Less...");	
			}else{
				$(this).html("More...");
			}
		});
		
	   /* ------------- added by Yaron/modified by Shlomo ------------ */
		$("#closeBut").parent().hide();
		$("#required").prev().hide();
		$("#required").hide();
		$("#required").next().hide();
		$("#values").hide();
		$("span.pln, span.kwd").css("cursor","pointer");
		$("span.pln, span.kwd").hover(function(eventObject){
			$(this).css("background-color","#CECECE");
			var currKey = $(eventObject.currentTarget).text().trim();
			if (currKey == "name") {
				var prevKey = $(eventObject.currentTarget).prev().prev("span.pln").text().trim();
					currKey = prevKey + "_" + currKey;
			}
			if (messages[currKey]) {
				var tooltip = $(".overlay"),
					position = $(eventObject.currentTarget).offset();
				$("#desc",tooltip).text(messages[currKey]);
				tooltip.show().offset({ top: position.top + tooltip.scrollTop() - 50, left: position.left + 100});
				$("#tipImg").position();
			}}, function(){
				$(".overlay").offset({top:0,left:0}).hide();
				$(this).css("background-color","transparent");
		});
	});
	
	</script>
	
	{% if needVersions != null %} 
		<script type="text/javascript">								
			var origOnLoad = window.onload;
			window.onload = function() {
				origOnLoad();
				addPageVersions();
			}	
		</script>			
		{% assign needVersions = null %}
	{% endif %}	
	
	<script type="text/javascript" src="/scripts/cloudify_default.js"></script>
	{% include googleanalytics.html %}
	{% include gauges.html %}
</head>