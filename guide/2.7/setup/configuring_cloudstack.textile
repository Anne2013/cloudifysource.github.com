---
layout: default
title: Configuring CloudStack Cloud
category: Installation & Setup
publish: true
abstract: Explains how to configure CloudStack Cloud for Cloudify
pageord: 600
--- 

This topic provides instructions for configuring CloudStack Cloud for Cloudify.

h2. Prerequisites

* A "(newwindow)CloudStack Cloud":http://www.citrix.com/products/cloudplatform/overview.html account
* Cloudify shell (for information about installing the Cloudify shell, see "Installing the Cloudify Shell":../setup/installing_the_cloudify_client)

h2. Configuring a CloudStack Cloud

This section provides step-by-step instructions for the following configuration tasks:

# "Generate a API Key and Secret Key":#key
# "Configure the Cloudify cloud driver configuration file":#driver
# "Configure NAT for non flat IP network architecture":#nat

h3(#key). Generate a API Key and Secret Key

# Login as administrator
# Go to Accounts
# Select the account which user belongs
# Click on View Users
# Select the user
# Click on generate keys icon and you'll be able to see them in the detail View
!/guide/images/cloudstack/create_api_key_and_secret_key.png!

h4(info). The generated key pairs will be used later with your driver configuration to communicate with the CloudStack Rest API.

h3(#driver). Configure the Cloudify cloud driver configuration file

First, download the [Cloudify CloudStcak driver files](https://github.com/CloudifySource/cloudify-cloud-drivers/tree/master/cloudstack) and place them in @<cloudifyRoot>/clouds/cloudstack/@
Edit the CloudStack cloud driver configuration file (@cloudstack-cloud.properties@) and modify the following attributes:

<pre class='prettyprint'>
//CloudStack API Key
apiKey="API_KEY"
//CloudStack Secret Key
secretKey="SECRET_KEY"

persistencePath="/var/cloudifyManagerState"

//The API Endpoint 
jcloudsEndpoint="CLOUDSTACK_ENDPOINT"
	
defaultSecurityGroup="default"

//The Hardware ID
hardwareId="HARDWARE_ID"

//The SSH user
userName="SSH_USER"
//The SSH password 
password="SSH_PASSWORD"

remoteUploadDirectory="/opt/cloudify"
localUploadDirectory="upload"

//The Image ID dest 
linuxImageIdDestinationManagement="IMAGE_ID_DEST"
linuxImageId="5"

//The network ID 
networkId="NETWORK_ID"
</pre>

You can obtain your *API Key* and *Secret Key* from the Account section of the CloudStack web console, as follows:
!/guide/images/cloudstack/api_keys_citrix_cloud_services.png!
<h4 class="impt">Note that the *Secret Key* must correspond to the *API Key* specified in the *user* attribute.</h4>

<br/>
The following is a sample list of CloudStack Image IDs. You can use CloudMonkey or [JClouds CLI](https://github.com/jclouds/jclouds-cli) to retreive the Hardware, network and image IDs. 

Here's are a few samples for the values of these fields: 

|_. ID |_. Image |	|_. ID |_. Image |
|e72f32dd-b9bb-44c0-aba9-546592a3e09a|Windows 7 v01 Image|_.	|5|CentOS 5.6(64-bit) no GUI (XenServer) Image|
|7a4fb437-f6d1-4b5c-a2fc-2dd91ec19da0|NetScaler VPX 9.3 for Xenserver|_.	|7|CentOS 5.3(64-bit) no GUI (vSphere) Image|

<br/>
The following is a list of CloudStack Hardware Ids:

|_. ID |_. Flavor Name |_. CPUs |_. RAM |_. Disk |
|0ef1c905-2daa-4da8-b444-04ed7fd6fda6|Mini| 1 | 256 MB | 2 GB |
|ebc56d93-2732-4265-9734-e0fdd52851b5|Small| 1 | 512 MB | 2 GB |
|60bdc030-338c-446d-a316-adc30fdaced7|Medium| 1 | 1 GB | 2 GB |
|9baa1a86-d9ab-4e58-ae67-269efa459a79|Large| 2 | 2 GB | 2 GB |


h3(#nat). Configuring NAT for Non Flat IP Network Architecture
# Login as Administrator
# Go to network
# Select a network name
# Go to the Egress rules tab
# set cidr 0.0.0.0/0 to All and add it
!/guide/images/cloudstack/configure_network_egress.png!
# Go to details tab and select View IP Addresses
# Click Aquire New IP for your virtual machine
!/guide/images/cloudstack/aquire_new_ip.png!
# Click the IP you created and configure firewall and Port forwarding
!/guide/images/cloudstack/configure_firewall_and_port_forwarding.png!
## configure the firewall port and cidr of vm
!/guide/images/cloudstack/configure_firewall.png!
## configure port forwarding
!/guide/images/cloudstack/configure_port_forwarding.png!

h4(warn). Repeat steps 6-8 for each vm would you like to access it from the internet.
e.g. workstation to install cloudify agent should be opened SSH port and cloudify agent vm should be opened port 8099-8100 to access Rest API and web ui

"Bootstrap CloudStack":../bootstrapping/bootstrapping_cloudstack
